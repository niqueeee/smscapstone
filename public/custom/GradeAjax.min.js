$(document).ready(function(){function e(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&r.draw()})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var t="/admin/grade",a="",r=$("#grade-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,columnDefs:[{width:"130px",targets:5},{width:"70px",targets:4}],columns:[{data:"description",name:"description"},{data:"highest_grade",name:"highest_grade"},{data:"lowest_grade",name:"lowest_grade"},{data:"failing_grade",name:"failing_grade"},{data:"is_active",name:"is_active",searchable:!1},{data:"action",name:"action",orderable:!1,searchable:!1}]});$("#add_grade").on("hide.bs.modal",function(){$("#frmGrade").parsley().destroy(),$("#frmGrade").trigger("reset")}),$("#grade-list").on("change","#isActive",function(){var a=$(this).val();$.ajax({url:"/admin/grade/checkbox/"+a,type:"PUT",success:function(t){Pace.restart(),console.log(t),"Deleted"==t&&e()},error:function(e){console.log(t+"/"+a),console.log("Error:",e)}})}),$("#grade-list").on("click",".open-modal",function(){var r=$(this).val();a=r,$.get(t+"/"+r+"/edit",function(t){console.log(t),"Deleted"==t?e():($("h4").text("Edit Academic Grading"),$("#strSystDesc").val(t.description),$("#dblSystHighGrade").val(t.highest_grade),$("#dblSystLowGrade").val(t.lowest_grade),$("#strSystFailGrade").val(t.failing_grade),$("#btn-save").val("update"),$("#add_grade").modal("show"))})}),$("#btn-add").click(function(){$("h4").text("Add Academic Grading"),$("#btn-save").val("add"),$("#frmGrade").trigger("reset"),$("#add_grade").modal("show")}),$("#grade-list").on("click",".btn-delete",function(){var a=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(s){setTimeout(function(){s&&$.ajax({url:t+"/"+a,type:"DELETE",success:function(t){console.log(t),"Deleted"==t?e():"true"==t[0]?swal({title:"Failed!",text:"<center>"+t[1].description+" is in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(r.draw(),swal({title:"Deleted!",text:"<center>"+t.description+" is Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){console.log(e)}})},500)})}),$("#btn-save").click(function(){if($("#frmGrade").parsley().destroy(),$("#frmGrade").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={strSystDesc:$("#strSystDesc").parsley("data-parsley-whitespace","squish").getValue(),dblSystLowGrade:$("#dblSystLowGrade").parsley("data-parsley-whitespace","squish").getValue(),strSystFailGrade:$("#strSystFailGrade").parsley("data-parsley-whitespace","squish").getValue(),dblSystHighGrade:$("#dblSystHighGrade").parsley("data-parsley-whitespace","squish").getValue()},s=$("#btn-save").val(),o="POST",n=t;"update"==s&&(o="PUT",n+="/"+a),$.ajax({type:o,url:n,data:e,dataType:"json",success:function(e){console.log(e),1==e?($("#strSystDesc").parsley().removeError("ferror",{updateClass:!1}),$("#strSystDesc").parsley().addError("ferror",{message:"This Data Already Exists",updateClass:!1})):2==e?($("#dblSystHighGrade").parsley().removeError("ferror",{updateClass:!1}),$("#dblSystHighGrade").parsley().addError("ferror",{message:"The Combination of Fields Exist",updateClass:!1}),$("#dblSystLowGrade").parsley().removeError("ferror",{updateClass:!1}),$("#dblSystLowGrade").parsley().addError("ferror",{message:"The Combination of Fields Exist",updateClass:!1})):($("#add_grade").modal("hide"),r.draw(),swal({title:"Success!",text:"<center>"+e.description+" is Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){console.log("Error:",e.responseText),$.notify({message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});