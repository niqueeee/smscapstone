$(document).ready(function(){function e(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&a.draw()})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var t="/admin/steps",n="",a=$("#steps-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,columnDefs:[{width:"130px",targets:4},{width:"70px",targets:3}],columns:[{data:"order",name:"order"},{data:"description",name:"description"},{data:"deadline",name:"deadline"},{data:"is_active",name:"is_active",searchable:!1},{data:"action",name:"action",orderable:!1,searchable:!1}]});$("#add_steps").on("hide.bs.modal",function(){$("#frmSteps").parsley().destroy(),$("#frmSteps").trigger("reset")}),$("#steps-list").on("change","#isActive",function(){var t=$(this).val();$.ajax({url:"/admin/steps/checkbox/"+t,type:"PUT",success:function(n){Pace.restart(),"Deleted"==n?e():$("#num"+t).replaceWith("<div id=num"+n.id+">"+n.order+"</div>")},error:function(e){}})}),$("#steps-list").on("click",".open-modal",function(){var a=$(this).val();n=a,$.get(t+"/"+a+"/edit",function(t){"Deleted"==t?e():($("#strStepDesc").val(t.description),$("#intStepDeadline").val(t.deadline),$("#intStepOrder").val(t.order).attr("readonly","readonly"),$("h4").text("Edit Step"),$("#btn-save").val("update"),$("#add_steps").modal("show"))})}),$("#btn-add").click(function(){$.get(t+"/create",function(e){$("#btn-save").val("add"),$("h4").text("Add Step"),$("#intStepOrder").val(e).attr("readonly","readonly"),$("#add_steps").modal("show")})}),$("#btn-order").click(function(){$("h4").text("Order Steps"),$.get(t+"/order",function(e){$(".todo-list").empty(),$("#count").empty();var t=1;$.each(e,function(e,n){var a="<li style='height: 35px;'><h5># "+t+++"</h5></li>",s="<li style='height: 40px;'><div class='col-xs-12 handle'><span><i class='fa fa-ellipsis-v'></i><i class='fa fa-ellipsis-v'></i></span><label>&emsp;"+n.description+"</label><input type='hidden' name='order[]' value="+n.id+"></div></li>";$(".todo-list").append(s),$("#count").append(a)}),$("#order_steps").modal("show")})}),$("#steps-list").on("click",".btn-delete",function(){var n=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(s){setTimeout(function(){s&&$.ajax({url:t+"/"+n,type:"DELETE",success:function(t){"Deleted"==t?e():"true"==t[0]?swal({title:"Failed!",text:"<center>"+t[1].description+" is in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(a.draw(),swal({title:"Deleted!",text:"<center>"+t.description+" is Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){}})},500)})}),$("#btn-save").click(function(){if($("#frmSteps").parsley().destroy(),$("#frmSteps").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={strStepDesc:$("#strStepDesc").parsley("data-parsley-whitespace","squish").getValue(),intStepDeadline:$("#intStepDeadline").val(),intStepOrder:$("#intStepOrder").val()},s=$("#btn-save").val(),i="POST",r=t;"update"==s&&(i="PUT",r+="/"+n),$.ajax({type:i,url:r,data:e,dataType:"json",success:function(e){$("#add_steps").modal("hide"),a.draw(),swal({title:"Success!",text:"<center>"+e.description+" is Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(e){$.notify({message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}}),$("#btn-submit").click(function(){$("#btn-submit").attr("disabled","disabled"),setTimeout(function(){$("#btn-submit").removeAttr("disabled")},1e3);var e=$("#frmOrder").serialize();$.ajax({type:"POST",url:"/admin/steps/order",data:e,dataType:"json",success:function(e){$("#order_steps").modal("hide"),a.draw(),swal({title:"Success!",text:"<center>"+e+"</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(e){$.notify({message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}),$(".todo-list").sortable({placeholder:"sort-highlight",handle:".handle",forcePlaceholderSize:!0,zIndex:999999})});