$(document).ready(function(){function e(e){$.get(i+"/"+e,function(e){if("Deleted"==e)t();else{$("#details").empty();var a="<label>Event Name</label><br>"+e.title+"<br><label>Event Place</label><br>"+e.place_held+"<br><label>From</label><br>"+e.time_from+"<br><label>To</label><br>"+e.time_to+"<br><label>Event Date</label><br>"+e.date_held+"<br><label>Description</label><br>"+e.description;$("#details").append(a),$("#details_events").modal("show")}})}function t(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&a()})}function a(){$.get(i+"/create",function(e){Pace.restart();var t="";$("#events").empty(),$.each(e,function(e,a){var n=new Date(a.date_held),i=new Date("October 13, 2014 "+a.time_from),l=new Date("October 13, 2014 "+a.time_to);t="Ongoing"==a.status?"checked":"";var o="<div class='col-md-4'><div class='small-box bg-purple'><div class='box-body'><div class='pull-right'><input type='checkbox' id='isActive' name='isActive' value="+a.id+" data-toggle='toggle' data-style='android' data-onstyle='success' data-offstyle='danger' data-on='Ongoing' data-off='Cancelled' "+t+" data-size='mini'> <button class='btn btn-warning btn-xs btn-detail open-modal' value="+a.id+"><i class='fa fa-edit'></i></button> <button class='btn btn-danger btn-xs btn-delete' value="+a.id+"><i class='fa fa-times'></i></button></div><h4><b>"+a.title+"</b></h4><p>"+n.toLocaleString("en-us",{weekday:"long"})+"</p><p>"+n.toLocaleString("en-us",{year:"numeric",month:"short",day:"2-digit"})+"</p><p>"+i.toLocaleString("en-us",{hour:"2-digit",minute:"2-digit"})+" - "+l.toLocaleString("en-us",{hour:"2-digit",minute:"2-digit"})+"</p></div><div class='icon'><i class='ion ion-person-add'></i></div><a value="+a.id+" class='btn small-box-footer'>View Event Details <i class='fa fa-arrow-circle-right'></i></a></div></div>";$("#events").append(o)}),$("[data-toggle='toggle']").bootstrapToggle("destroy"),$("[data-toggle='toggle']").bootstrapToggle()})}$(".timepicker").timepicker({showInputs:!1});var n="",i="/coordinator/events",l=new Date;l.setDate(l.getDate()),$("#datepicker").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:3,autoclose:!0,format:"yyyy-mm-dd",startDate:l}),$("#btn-add").click(function(){$("#txt").text("Add Event"),$("#btn-save").val("add"),$("#frmEvent").trigger("reset"),$("#add_event").modal("show")}),$("#events").on("click",".open-modal",function(){var e=$(this).val();n=e,$.get(i+"/"+e+"/edit",function(e){"Deleted"==e?t():($("#txt").text("Edit Event"),$("#frmEvent").trigger("reset"),$("#title").val(e.title),$("#place_held").val(e.place_held),$("#time_from").val(e.time_from),$("#time_to").val(e.time_to),$("#datepicker").val(e.date_held),$("#description").val(e.description),$("#btn-save").val("update"),$("#add_event").modal("show"))})}),$("#events").on("click",".small-box-footer",function(){e($(this).attr("value"))}),$(".details").on("click",function(){e($(this).attr("value"))}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#btn-save").click(function(){if($("#frmEvent").parsley().destroy(),$("#frmEvent").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={title:$("#title").val(),place_held:$("#place_held").val(),time_from:$("#time_from").val(),time_to:$("#time_to").val(),date_held:$("#datepicker").val(),description:$("#description").val()},t=$("#btn-save").val(),l="POST",o=i;"update"==t&&(l="PUT",o+="/"+n),$.ajax({type:l,url:o,data:e,dataType:"json",success:function(e){$("#add_event").modal("hide"),a(),swal({title:"Success!",text:"<center>"+e.title+" is Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(e){$.notify({message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}}),$("#events").on("click",".btn-delete",function(){var e=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(n){setTimeout(function(){n&&$.ajax({url:i+"/"+e,type:"DELETE",success:function(e){"Deleted"==e?t():"true"==e[0]?swal({title:"Failed!",text:"<center>"+e[1].title+" is in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(a(),swal({title:"Deleted!",text:"<center>"+e.title+" is Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){}})},500)})}),$("#events").on("change","#isActive",function(){var e=$(this).val();$.ajax({url:"/coordinator/events/checkbox/"+e,type:"PUT",success:function(e){Pace.restart(),"Deleted"==e&&t()},error:function(e){}})})});