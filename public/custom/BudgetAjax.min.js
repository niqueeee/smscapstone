$(document).ready(function(){function t(){for(var t=0,e=0;e<d.length;e++)t+=parseFloat(d[e].value,10);if($("#budget_per_student").val(t),$("#budget_per_student").val().length>0){var a,n,o=(a=parseFloat($("#budget_amount").val()))/(n=parseFloat($("#budget_per_student").val()));$("#slot_count").val(Math.floor(o))}}function e(){$.get(n+"/getlatest",function(t){$(".slot").text(t.slot_count),$(".budget").text(t.amount)})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var a=$("#budget-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,order:[3,"desc"],columnDefs:[{width:"180px",targets:4}],fnRowCallback:function(t,e,a,n){$("td:eq(0),td:eq(1)",t).addClass("text-right")},columns:[{data:"amount",name:"amount"},{data:"budget_per_student",name:"budget_per_student"},{data:"slot_count",name:"slot_count"},{data:"budget_date",name:"budget_date"},{data:"action",name:"action",orderable:!1,searchable:!1}]}),n="/coordinator/budget",o="";$("#add_budget").on("hide.bs.modal",function(){$("#frmBudget").trigger("reset"),$(".form-control").val()}),$("#btn-add").click(function(){$("#add_budget").modal("show"),$("h4").text("Add Budget"),$("#btn-save").val("add")}),$("#budget-list").on("click",".btn-view",function(){var t=$(this).val();$.get(n+"/"+t,function(t){var e=new Date(t[0].budget_date),a="<div class='col-xs-12 row'><div class='col-xs-6'><div class='form-group'><label>Budget Amount:</label><br>"+t[0].amount+"</div><div class='form-group'><label>Scholar Budget:</label><br>"+t[0].budget_per_student+"</div></div><div class='col-xs-6'><div class='form-group'><label>Date Inputted:</label><br>"+e.toLocaleString("en-us",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})+"</div><div class='form-group'><label>Slot:</label><br>"+t[0].slot_count+"</div></div>";$.each(t,function(t,e){a+="<div class='col-xs-6'><div class='form-group'><label>"+e.description+" Amount:</label><br>"+e.allocation_amount+"</div></div>"}),a+="</div>",bootbox.alert({title:"View Budget",message:a,backdrop:!0,buttons:{ok:{label:"Ok",className:"btn-success btn-md"}}})})}),$("#budget-list").on("click",".open-modal",function(){var t=$(this).val();o=t,$.get(n+"/"+t+"/edit",function(t){$("#budget_amount").val(t[0].amount),$("#budget_per_student").val(t[0].budget_per_student),$("#slot_count").val(t[0].slot_count),$.each(t,function(t,e){$("#id"+e.allocation_id).val(e.allocation_amount),$(".allocate").append("<input type='hidden' name='allocation_id[]' value='"+e.allocate_id+"'>")}),$("h4").text("Edit Budget"),$("#btn-save").val("update"),$("#add_budget").modal("show")})}),$("#budget-list").on("click",".btn-delete",function(){var t=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(o){setTimeout(function(){o&&$.ajax({url:n+"/"+t,type:"DELETE",success:function(t){a.draw(),e(),swal({title:"Deleted!",text:"<center>Data Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(t){}})},500)})}),$("#budget_amount").blur(function(){t()});for(var l=document.getElementsByName("amount[]"),d=Array.prototype.slice.call(l),s=0;s<d.length;s++)d[s].addEventListener("blur",t);$("#btn-save").click(function(){if($("#frmBudget").parsley().destroy(),$("#frmBudget").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var t=$("#frmBudget").serialize(),l=$("#btn-save").val(),d="POST",s=n;"update"==l&&(d="PUT",s+="/"+o),$.ajax({type:d,url:s,data:t,dataType:"json",success:function(t){$("#add_budget").modal("hide"),a.draw(),e(),swal({title:"Success!",text:"<center>Data Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(t){$.notify({icon:"fa fa-warning",message:t.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});