$(document).ready(function(){function t(){for(var t=0,e=0;e<l.length;e++)t+=parseFloat(l[e].value,10);$("#remain").val(parseFloat($("#budget_per_student").val())-t),$("#summation").val(t)}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var e=$("#budget-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,order:[3,"desc"],columnDefs:[{width:"180px",targets:4}],columns:[{data:"amount",name:"amount"},{data:"budget_per_student",name:"budget_per_student"},{data:"slot_count",name:"slot_count"},{data:"budget_date",name:"budget_date"},{data:"action",name:"action",orderable:!1,searchable:!1}]}),a="/coordinator/budget",n="";$("#add_budget").on("hide.bs.modal",function(){$("#frmBudget").trigger("reset")}),$("#btn-add").click(function(){$("#add_budget").modal("show")}),$("#budget-list").on("click",".btn-view",function(){var t=$(this).val();$.get(a+"/"+t,function(t){var e=new Date(t[0].budget_date),a="<div class='col-xs-12 row'><div class='col-xs-6'><div class='form-group'><label>Budget Amount:</label><br>"+t[0].amount+"</div><div class='form-group'><label>Scholar Budget:</label><br>"+t[0].budget_per_student+"</div></div><div class='col-xs-6'><div class='form-group'><label>Date Inputted:</label><br>"+e.toLocaleString("en-us",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})+"</div><div class='form-group'><label>Slot:</label><br>"+t[0].slot_count+"</div></div>";$.each(t,function(t,e){a+="<div class='col-xs-6'><div class='form-group'><label>"+e.description+" Amount:</label><br>"+e.allocation_amount+"</div></div>"}),a+="</div>",bootbox.alert({title:"View Budget",message:a,backdrop:!0,buttons:{ok:{label:"Ok",className:"btn-success btn-md"}}})})}),$("#budget-list").on("click",".open-modal",function(){var t=$(this).val();n=t,$.get(a+"/"+t+"/edit",function(t){$("#budget_amount").val(t[0].amount),$("#budget_per_student").val(t[0].budget_per_student),$("#slot_count").val(t[0].slot_count),$.each(t,function(t,e){$("#id"+e.allocation_id).val(e.allocation_amount)}),$("h4").text("Edit Budget"),$("#btn-save").val("update"),$("#add_budget").modal("show")})}),$("#budget-list").on("click",".btn-delete",function(){var t=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(n){setTimeout(function(){n&&$.ajax({url:a+"/"+t,type:"DELETE",success:function(t){$(".budget").text(t.amount),e.draw(),swal({title:"Deleted!",text:"<center>Budget Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(t){}})},500)})}),$("#budget_per_student").keyup(function(){if($("#budget_per_student").val().length>0){var t,e,a=(t=parseFloat($("#budget_amount").val()))/(e=parseFloat($("#budget_per_student").val()));$("#slot_count").val(Math.floor(a))}}),$("#budget_per_student").blur(function(){$("#remain").val($(this).val())});for(var o=document.getElementsByName("amount[]"),l=Array.prototype.slice.call(o),d=0;d<l.length;d++)l[d].addEventListener("keyup",t);$("#btn-save").click(function(t){if($("#summation").val()==$("#budget_per_student").val()){if($("#frmBudget").parsley().destroy(),$("#frmBudget").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var o=$("#frmBudget").serialize(),l=$("#btn-save").val(),d="POST",u=a;"update"==l&&(d="PUT",u+="/"+n),$.ajax({type:d,url:u,data:o,dataType:"json",success:function(t){$("#add_budget").modal("hide"),$(".budget").text(t.amount),e.draw(),swal({title:"Success!",text:"<center>Budget Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(t){$.notify({icon:"fa fa-warning",message:t.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}}else t.preventDefault(),$.notify({icon:"fa fa-warning",message:"Fees not Equal to Budget Amount"},{type:"warning",z_index:2e3,delay:5e3})})});