$(document).ready(function(){function e(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&o.draw()})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var t="/admin/credit",n="",o=$("#table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,columnDefs:[{width:"130px",targets:4},{width:"70px",targets:3},{width:"70px",targets:2}],columns:[{data:"schools_description",name:"schools.description"},{data:"courses_description",name:"courses.description"},{data:"year",name:"school_course.year"},{data:"semester",name:"school_course.semester"},{data:"action",name:"action",orderable:!1,searchable:!1}]});$("#add_course").on("hide.bs.modal",function(){$("#frm").parsley().destroy(),$("#frm").trigger("reset")}),$("#list").on("click",".open-modal",function(){var o=$(this).val();n=o,$.get(t+"/"+o+"/edit",function(t){if("Deleted"==t)e();else{for(var n=t.schools_description,o=document.getElementById("school_id"),s=0;s<o.options.length;s++)if(o.options[s].text===n){o.selectedIndex=s;break}for(var a=t.courses_description,r=document.getElementById("course_id"),s=0;s<r.options.length;s++)if(r.options[s].text===a){r.selectedIndex=s;break}for(var c=t.year,i=document.getElementById("year"),s=0;s<i.options.length;s++)if(i.options[s].text===c){i.selectedIndex=s;break}for(var l=t.semester,d=document.getElementById("semester"),s=0;s<d.options.length;s++)if(d.options[s].text===l){d.selectedIndex=s;break}$("h4").text("Edit Credit"),$("#btn-save").val("update"),$("#add_course").modal("show")}})}),$("#btn-add").click(function(){$("h4").text("Add Credit"),$("#btn-save").val("add"),$("#frm").trigger("reset"),$("#add_course").modal("show")}),$("#list").on("click",".btn-delete",function(){var n=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(s){setTimeout(function(){s&&$.ajax({url:t+"/"+n,type:"DELETE",success:function(t){"Deleted"==t?e():"true"==t[0]?swal({title:"Failed!",text:"<center>Data in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(o.draw(),swal({title:"Deleted!",text:"<center>Data Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){}})},500)})}),$("#btn-save").click(function(){if($("#frm").parsley().destroy(),$("#frm").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={school_id:$("#school_id").val(),course_id:$("#course_id").val(),year:$("#year").val(),semester:$("#semester").val()},s=$("#btn-save").val(),a="POST",r=t;"update"==s&&(a="PUT",r+="/"+n),$.ajax({type:a,url:r,data:e,dataType:"json",success:function(e){$("#add_course").modal("hide"),o.draw(),swal({title:"Success!",text:"<center>Data Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(e){$.notify({icon:"fa fa-warning",message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});