$(document).ready(function(){function e(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&r.draw()})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var t="/admin/councilor",a="",r=$("#councilor-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,columnDefs:[{width:"180px",targets:3},{width:"70px",targets:2}],columns:[{data:"strCounName",name:"strCounName"},{data:"district_description",name:"districts.description"},{data:"is_active",name:"councilors.is_active",searchable:!1},{data:"action",name:"action",orderable:!1,searchable:!1}]});$("#add_councilor").on("hide.bs.modal",function(){$("#frmCouncilor").parsley().destroy(),$("#frmCouncilor").trigger("reset")}),$("#councilor-list").on("change","#isActive",function(){var t=$(this).val();$.ajax({url:"/admin/councilor/checkbox/"+t,type:"PUT",success:function(t){Pace.restart(),console.log(t),"Deleted"==t&&e()},error:function(e){console.log("Error:",e)}})}),$("#councilor-list").on("click",".open-modal",function(){var r=$(this).val();a=r,$.get(t+"/"+r+"/edit",function(t){if(console.log(t),"Deleted"==t)e();else{for(var a=t.district_description,r=document.getElementById("intCounDistID"),s=0;s<r.options.length;s++)if(r.options[s].text===a){r.selectedIndex=s;break}$("h4").text("Edit Councilor"),$("#strCounFirstName").val(t.first_name),$("#strCounMiddleName").val(t.middle_name),$("#strCounLastName").val(t.last_name),$("#strCounEmail").val(t.email),$("#strCounCell").val(t.cell_no),$("#strUserEmail").val(t.user_email),$("#btn-save").val("update"),$("#add_councilor").modal("show")}})}),$("#councilor-list").on("click",".btn-view",function(){var a=$(this).val();$.get(t+"/"+a,function(t){if("Deleted"==t)e();else{console.log(t),$("#details").empty();var a="<label>ID</label><br>"+t.id+"<br><label>District</label><br>"+t.district_description+"<br><label>Name</label><br>"+t.last_name+", "+t.first_name+" "+t.middle_name+"<br><label>Email</label><br>"+t.email+"<br><label>Contact Number</label><br>"+t.cell_no;$("h4").text("View Councilor"),$("#details").append(a),$("#details_councilor").modal("show")}})}),$("#btn-add").click(function(){$("h4").text("Add Councilor"),$("#btn-save").val("add"),$("#frmCouncilor").trigger("reset"),$("#add_councilor").modal("show")}),$("#councilor-list").on("click",".btn-delete",function(){var e=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(a){setTimeout(function(){a&&$.ajax({url:t+"/"+e,type:"DELETE",success:function(e){console.log(e),"true"==e[0]?swal({title:"Failed!",text:"<center>"+e[1].last_name+" is in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(r.draw(),swal({title:"Deleted!",text:"<center>"+e.last_name+" is Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){console.log(e)}})},500)})}),$("#btn-save").click(function(){if($("#frmCouncilor").parsley().destroy(),$("#frmCouncilor").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={strCounFirstName:$("#strCounFirstName").parsley("data-parsley-whitespace","squish").getValue(),strCounMiddleName:$("#strCounMiddleName").parsley("data-parsley-whitespace","squish").getValue(),strCounLastName:$("#strCounLastName").parsley("data-parsley-whitespace","squish").getValue(),intCounDistID:$("#intCounDistID").val(),strCounEmail:$("#strCounEmail").parsley("data-parsley-whitespace","squish").getValue(),strCounCell:$("#strCounCell").parsley("data-parsley-whitespace","squish").getValue(),strUserEmail:$("#strUserEmail").parsley("data-parsley-whitespace","squish").getValue()},s=$("#btn-save").val(),o="POST",l=t;"update"==s&&(o="PUT",l+="/"+a),$.ajax({type:o,url:l,data:e,dataType:"json",success:function(e){console.log(e),1==e?($("#strCounFirstName").parsley().removeError("ferror",{updateClass:!1}),$("#strCounFirstName").parsley().addError("ferror",{message:"The Combination of Name Exists",updateClass:!1}),$("#strCounMiddleName").parsley().removeError("ferror",{updateClass:!1}),$("#strCounMiddleName").parsley().addError("ferror",{message:"The Combination of Name Exists",updateClass:!1}),$("#strCounLastName").parsley().removeError("ferror",{updateClass:!1}),$("#strCounLastName").parsley().addError("ferror",{message:"The Combination of Name Exists",updateClass:!1})):2==e?($("#strCounEmail").parsley().removeError("ferror",{updateClass:!1}),$("#strCounEmail").parsley().addError("ferror",{message:"This Data Already Exists",updateClass:!1})):3==e?($("#strUserEmail").parsley().removeError("ferror",{updateClass:!1}),$("#strUserEmail").parsley().addError("ferror",{message:"This Data Already Exists",updateClass:!1})):($("#add_councilor").modal("hide"),r.draw(),swal({title:"Success!",text:"<center>"+e.last_name+", "+e.first_name+" "+e.middle_name+" is Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){console.log("Error:",e.responseText),$.notify({message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});