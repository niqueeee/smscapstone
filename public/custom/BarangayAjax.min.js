$(document).ready(function(){function e(){swal({title:"Record Deleted!",type:"warning",text:"<center>Refresh Records?</center>",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Refresh",cancelButtonText:"Cancel",closeOnConfirm:!0,allowOutsideClick:!0,closeOnCancel:!0},function(e){e&&n.draw()})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var a="/admin/barangay",t="",n=$("#barangay-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,columnDefs:[{width:"130px",targets:3},{width:"70px",targets:2}],columns:[{data:"districts_description",name:"districts.description"},{data:"description",name:"barangay.description"},{data:"is_active",name:"barangay.is_active",searchable:!1},{data:"action",name:"action",orderable:!1,searchable:!1}]});$("#add_barangay").on("hide.bs.modal",function(){$("#frmBarangay").parsley().destroy(),$("#frmBarangay").trigger("reset")}),$("#barangay-list").on("change","#isActive",function(){var a=$(this).val(),t=0;if($(this).prop("checked"))t=1;var n={is_active:t};$.ajax({url:"/admin/barangay/checkbox/"+a,type:"PUT",data:n,success:function(a){Pace.restart(),"Deleted"==a&&e()},error:function(e){}})}),$("#barangay-list").on("click",".open-modal",function(){$("#strBaraDesc").parsley().removeError("ferror",{updateClass:!1});var n=$(this).val();t=n,$.get(a+"/"+n+"/edit",function(a){if("Deleted"==a)e();else{for(var t=a.districts_description,n=document.getElementById("intDistID"),r=0;r<n.options.length;r++)if(n.options[r].text===t){n.selectedIndex=r;break}$("h4").text("Edit Barangay"),$("#strBaraDesc").val(a.description),$("#btn-save").val("update"),$("#add_barangay").modal("show")}})}),$("#btn-add").click(function(){$("#strBaraDesc").parsley().removeError("ferror",{updateClass:!1}),$("h4").text("Add Barangay"),$("#btn-save").val("add"),$("#frmBarangay").trigger("reset"),$("#add_barangay").modal("show")}),$("#barangay-list").on("click",".btn-delete",function(){var t=$(this).val();swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Delete",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(r){setTimeout(function(){r&&$.ajax({url:a+"/"+t,type:"DELETE",success:function(a){"Deleted"==a?e():"true"==a[0]?swal({title:"Failed!",text:"<center>Data in use</center>",type:"error",showConfirmButton:!1,allowOutsideClick:!0,html:!0}):(n.draw(),swal({title:"Deleted!",text:"<center>Data Deleted</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0}))},error:function(e){}})},500)})}),$("#btn-save").click(function(){if($("#frmBarangay").parsley().destroy(),$("#frmBarangay").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var e={intDistID:$("#intDistID").val(),strBaraDesc:$("#strBaraDesc").parsley("data-parsley-whitespace","squish").getValue()},r=$("#btn-save").val(),s="POST",i=a;"update"==r&&(s="PUT",i+="/"+t),$.ajax({type:s,url:i,data:e,dataType:"json",success:function(e){$("#add_barangay").modal("hide"),n.draw(),swal({title:"Success!",text:"<center>Data Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(e){$.notify({icon:"fa fa-warning",message:e.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});